var fs = require('fs');
exports.start = function(ServicePath)
{
    setInterval(AutoLoad,1000,ServicePath);
    console.log("服务模块加载完毕");
}
var FileList={};
function AutoLoad(ServicePath)
{
    var dirList = fs.readdirSync(ServicePath);

    dirList.forEach(function(item){
        try
        {
            if (fs.statSync(ServicePath + item).isDirectory())
            {
                AutoLoad(ServicePath + item+"\\")
                return;
            }
            var mtime=fs.statSync(ServicePath + item).mtime;
            if (String(FileList[ServicePath + item])!=String(mtime))
            {
                if (FileList[ServicePath + item]!=undefined)
                {
                    console.log("检测到模块"+item+"变更,重载模块");

                    //删除模块缓存
                    delete require.cache[require.resolve(ServicePath + item)];
                    try {
                        require(require.resolve(ServicePath + item));
                    }
                    catch (e)
                    {
                        console.log("加载模块"+item+"时发生错误",e);
                    }

//                   console.log("检测到模块"+item+"变更,重载所有模块");

//                    for (var itemName in FileList) {
//                            delete require.cache[require.resolve(itemName)];
//                            try {
//                                require(require.resolve(itemName));
//                            }
//                            catch (e)
//                            {
//                                console.log("加载模块"+itemName+"时发生错误",e);
//                            }
//
//                    }
                }
                FileList[ServicePath + item]=mtime;
            }
        }
        catch (e)
        {}


    });
}